http:
  middlewares:
    auth:
      chain:
        middlewares:
          - auth-error
          - forward-auth
    forward-auth:
      forwardAuth:
        address: http://auth:4181
        trustForwardHeader: true
        authResponseHeaders:
          - X-Forwarded-User
    auth-error:
      errors:
        status:
          - 401
        service: static@docker
        query: /401.html
  routers:
    staging-web:
      rule: HostRegexp("staging.mchill.duckdns.org", "{subdomain:[a-z]+}.staging.mchill.duckdns.org")
      service: staging-web
      entryPoints:
        - web
    staging-websecure:
      rule: HostRegexp("staging.mchill.duckdns.org", "{subdomain:[a-z0-9]+}.staging.mchill.duckdns.org")
      service: staging-websecure
      entryPoints:
        - websecure
    nas:
      rule: Host("nas.mchill.duckdns.org")
      service: nas
      middlewares:
        - auth
      entryPoints:
        - websecure
    homeassistant:
      rule: Host("home.mchill.duckdns.org")
      service: homeassistant
      entryPoints:
        - websecure
  services:
    staging-web:
      loadBalancer:
        servers:
          - url: http://192.168.86.149:30080
    staging-websecure:
      loadBalancer:
        servers:
          - url: https://192.168.86.149:30443
    nas:
      loadBalancer:
        servers:
          - url: http://192.168.86.159:5000
    homeassistant:
      loadBalancer:
        servers:
          - url: http://192.168.86.149:8123
